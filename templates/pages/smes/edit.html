<!-- Modal: Edit SME Details -->
<div class="modal fade" id="editSmeModal" tabindex="-1" role="dialog" aria-labelledby="editSmeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white shadow-sm rounded-top">
                <h4 class="modal-title" id="editSmeModalLabel"><i class="fas fa-edit text-white"></i> Edit SME</h4>
                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="editSMEForm" autocomplete="off" class="px-4 py-3">

                    <!-- Business Information Section -->
                    <div class="section-header bg-dark text-white  py-2 px-3 rounded mb-4">
                        <h5><i class="fas fa-industry text-white"></i> Business Information</h5>
                    </div>

                    <div class="row g-4 mb-4">
                        <div class="col-md-6">
                            <label for="company" class="form-label">Company Name</label>
                            <input type="text" class="form-control" id="company" name="company" placeholder="Enter Company Name">
                        </div>
                        <div class="col-md-6">
                            <label for="type_of_business" class="form-label">Form of Business</label>
                            <select class="form-control " id="type_of_business" name="type_of_business">
                                <option disabled>Select Form of Business</option>
                                <option value="Private Limited">Private Limited</option>
                                <option value="Private Business Cooperation">Private Business Cooperation</option>
                                <option value="Cooperative">Cooperative</option>
                                <option value="Partnership">Partnership</option>
                                <option value="Syndicate">Syndicate</option>
                                <option value="Consortium">Consortium</option>
                                <option value="Group">Group</option>
                                <option value="Sole Proprietorship">Sole Proprietorship</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="registration" class="form-label">Registration Status</label>
                            <select class="form-control " id="registration" name="registration">
                                <option disabled>Select Registration Status</option>
                                <option value="Registered">Registered</option>
                                <option value="Not-Registered">Not Registered</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="sector" class="form-label">Sector</label>
                            <select class="form-control " id="sector" name="sector">
                                <option disabled>Select Sector</option>
                            </select>
                        </div>
                    </div>

                    <div class="row g-4 mb-4">
                        <div class="col-md-4">
                            <label for="product_service" class="form-label">Product or Service</label>
                            <input type="text" class="form-control" id="product_service" name="product_service" placeholder="Enter Product or Service">
                        </div>
                        <div class="col-md-4">
                            <label for="number_of_employees" class="form-label">Number of Employees</label>
                            <input type="number" class="form-control" id="number_of_employees" name="number_of_employees" placeholder="Enter Number of Employees">
                        </div>
                        <div class="col-md-4">
                            <label for="export" class="form-label">Exports</label>
                            <select class="form-control " id="export" name="export">
                                <option disabled>Select Exports Status</option>
                                <option value="Exporter">Exporter</option>
                                <option value="Non-Exporter">Non-Exporter</option>
                            </select>
                        </div>
                    </div>

                    <div class="row g-4 mb-4">
                        <div class="col-md-4">
                            <label for="ownership" class="form-label">Ownership</label>
                            <select class="form-control " id="ownership" name="ownership">
                                <option disabled>Select Ownership</option>
                                <option value="Youth owned">Youth Owned</option>
                                <option value="Women Owned">Women Owned</option>
                                <option value="Men Owned">Men Owned</option>
                                <option value="Warvets Owned">Warvets Owned</option>
                                <option value="Disabled Owned">Disabled Owned</option>
                            </select>
                        </div>
                    </div>

                    <!-- Contact Info -->
                    <div class="section-header bg-info text-white py-2 px-3 rounded mb-4">
                        <h5><i class="fas fa-user text-white"></i> Business Contact Information</h5>
                    </div>

                    <div class="row g-4 mb-4">
                        <div class="col-md-6">
                            <label for="contact_person" class="form-label">Contact Person</label>
                            <input type="text" class="form-control" id="contact_person" name="contact_person" placeholder="Enter Contact Person Name">
                        </div>
                        <div class="col-md-6">
                            <label for="address" class="form-label">Business Physical Address</label>
                            <input type="text" class="form-control" id="address" name="address" placeholder="Enter Address">
                        </div>
                    </div>

                    <div class="row g-4 mb-4">
                        <div class="col-md-4">
                            <label for="phone_number" class="form-label">Phone Number</label>
                            <input type="text" class="form-control" id="phone_number" name="phone_number" placeholder="Enter Phone Number">
                        </div>
                        <div class="col-md-4">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="email" name="email" placeholder="Enter Email">
                        </div>
                        <div class="col-md-4">
                            <label for="education" class="form-label">Managerial Education Level</label>
                            <select class="form-control " id="education" name="education">
                                <option disabled>Select Education Level</option>
                                <option value="Primary">Primary</option>
                                <option value="O Level">O Level</option>
                                <option value="A Level">A Level</option>
                                <option value="Tertiary">Tertiary</option>
                                <option value="None">None</option>
                            </select>
                        </div>
                    </div>

                    <!-- Business Support -->
                    <div class="section-header bg-success text-white py-2 px-3 rounded mb-4">
                        <h5><i class="fas fa-cogs text-white"></i> Business Support Services Received</h5>
                    </div>
                    <div class="row g-4 mb-4">
                        <!-- Edit Modal Support Services -->
                        <div class="col-md-6">
                            <label for="edit_support_service" class="form-label">Support Service</label>
                            <select class="form-control select2" id="edit_support_service" name="edit_support_service[]" multiple required>
                                <option value="Funding">Funding</option>
                                <option value="Workspace">Workspace</option>
                                <option value="Registration">Registration</option>
                                <option value="Training">Training</option>
                                <option value="Market Access">Market Access</option>
                                <option value="Standards Development">Standards Development</option>
                            </select>
                        </div>

                        <div class="col-md-6" id="edit_training_field" style="display: none;">
                            <label for="edit_training_received" class="form-label">Training Received</label>
                            <input type="text" class="form-control" id="edit_training_received" name="edit_training_received" placeholder="Enter Training Received">
                        </div>

                        <div class="col-md-6" id="edit_funding_field" style="display: none;">
                            <label for="edit_funding_received" class="form-label">Funding Received</label>
                            <input type="text" class="form-control" id="edit_funding_received" name="edit_funding_received" placeholder="Enter Funding Received">
                        </div>
                    </div>

                    <!-- Compliance -->
                    <div class="section-header bg-warning text-white py-2 px-3 rounded mb-4">
                        <h5><i class="fas fa-shield-alt text-white"></i> Compliance</h5>
                    </div>
                    <div class="row g-4 mb-4">
                        <div class="col-md-6">
                            <label for="compliance" class="form-label">Compliance</label>
                            <input type="text" class="form-control" id="compliance" name="compliance" placeholder="Enter Compliance">
                        </div>
                        <div class="col-md-6">
                            <label for="tax" class="form-label">Tax</label>
                            <input type="text" class="form-control" id="tax" name="tax" placeholder="Enter Tax">
                        </div>
                    </div>

                    <!-- Financial Info -->
                    <div class="section-header bg-danger text-white py-2 px-3 rounded mb-4">
                        <h5><i class="fas fa-wallet text-white"></i> Financial Information</h5>
                    </div>
                    <div class="row g-4 mb-4">
                        <div class="col-md-4">
                            <label for="source_of_funds" class="form-label">Source of Capital Funds</label>
                            <select class="form-control " id="source_of_funds" name="source_of_funds">
                                <option disabled>Select Source</option>
                                <option value="Government loan">Government loan</option>
                                <option value="Venture capital">Venture capital</option>
                                <option value="Own savings">Own savings</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="annual_revenue" class="form-label">Annual Turnover (USD)</label>
                            <input type="number" class="form-control" id="annual_revenue" name="annual_revenue" placeholder="Enter Turnover">
                        </div>
                        <div class="col-md-4">
                            <label for="asset_value" class="form-label">Assets Value (USD)</label>
                            <input type="number" class="form-control" id="asset_value" name="asset_value" placeholder="Enter Asset Value">
                        </div>
                    </div>

                    <!-- Challenges -->
                    <div class="section-header bg-info text-white py-2 px-3 rounded mb-4">
                        <h5><i class="fas fa-exclamation-circle text-white"></i> Challenges</h5>
                    </div>
                    <div class="row mb-4">
                        <div class="col-md-12">
                            <textarea class="form-control" name="comments" id="comments" rows="3" placeholder="Enter Challenges"></textarea>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal"><i class="fas fa-times"></i> Close</button>
                        <button type="submit" class="btn btn-success btn-sm"><i class="fas fa-save"></i> Update SME</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Initialize Select2 for both modals
        $('#support_service, #edit_support_service').select2({
            placeholder: "Select support services",
            width: '100%'
        });

        // Function to toggle fields based on selected values
        function toggleFields(modalIdSuffix) {
            const supportService = $(`#${modalIdSuffix}_support_service`).val() || [];
        
            const trainingField = document.getElementById(`${modalIdSuffix}_training_field`);
            const fundingField = document.getElementById(`${modalIdSuffix}_funding_field`);
            const trainingInput = document.getElementById(`${modalIdSuffix}_training_received`);
            const fundingInput = document.getElementById(`${modalIdSuffix}_funding_received`);
        
            if (supportService.includes('Training')) {
                trainingField.style.display = 'block';
                trainingInput.setAttribute('required', 'required');
            } else {
                trainingField.style.display = 'none';
                trainingInput.removeAttribute('required');
                trainingInput.value = '';
            }
        
            if (supportService.includes('Funding')) {
                fundingField.style.display = 'block';
                fundingInput.setAttribute('required', 'required');
            } else {
                fundingField.style.display = 'none';
                fundingInput.removeAttribute('required');
                fundingInput.value = '';
            }
        }
        

        // Setup listeners for both modals
        $('#support_service').on('change', () => toggleFields(''));
        $('#edit_support_service').on('change', () => toggleFields('edit'));

        // Trigger after setting initial values
        $('#editSmeModal').on('shown.bs.modal', function () {
            toggleFields('edit');
        });

        // Initial toggle for new form
        toggleFields('');
    });
</script>

