{% extends 'layouts/base.html' %}
{% load static %}

{% block title %}| Dashboard {% endblock title %}

{% block extrastyle %}

  <!-- Ionicons -->
  <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
  <!-- Tempusdominus Bootstrap 4 -->
  <link rel="stylesheet" href="{% static 'plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css' %}">
  <!-- iCheck -->
  <link rel="stylesheet" href="{% static 'plugins/icheck-bootstrap/icheck-bootstrap.min.css' %}">
  <!-- JQVMap -->
  <link rel="stylesheet" href="{% static 'plugins/jqvmap/jqvmap.min.css' %}">
  <!-- Daterange picker -->
  <link rel="stylesheet" href="{% static 'plugins/daterangepicker/daterangepicker.css' %}">
  <!-- summernote -->
  <link rel="stylesheet" href="{% static 'plugins/summernote/summernote-bs4.min.css' %}">

{% endblock extrastyle %}

{% block bodyclass %} hold-transition sidebar-mini layout-fixed {% endblock bodyclass %}

{% block content %}
  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <div class="content-header">
      <div class="container-fluid">
        <div class="row mb-2">
          <div class="col-sm-6">
            <h1 class="m-0">Dashboard</h1>
          </div><!-- /.col -->
          <div class="col-sm-6">
            <ol class="breadcrumb float-sm-right">
              <li class="breadcrumb-item"><a href="#">Home</a></li>
              <li class="breadcrumb-item active">Dashboard</li>
            </ol>
          </div><!-- /.col -->
        </div><!-- /.row -->
      </div><!-- /.container-fluid -->
    </div>
    <!-- /.content-header -->

    <!-- Main content -->
    <section class="content">
      <div class="container-fluid">
        <!-- Small boxes (Stat box) -->
        <div class="row">
          <div class="col-lg-3 col-6">
            <!-- small box -->
            <div class="small-box bg-success">
              <div class="inner">
                <div class="row">
                  <div class="col-6">
                    <h4 class="mb-1 mt-1"><span data-plugin="counterup">{{ micro_count }}</span></h4>
                  </div>
                  <div class="col-6 text-right">
                    <h4 class="mb-1 mt-1"><span data-plugin="counterup">{{ micro_percentage }}%</span></h4>
                  </div>
                </div>
                <div class="text-center">
                  <p class="text-white mb-0">MICRO</p>
                </div>
              </div>
              <div class="icon">
                <i class="ion ion-b"></i>
              </div>
              <a href="#" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a>
            </div>
          </div>
          <!-- ./col -->
          <div class="col-lg-3 col-6">
            <!-- small box -->
            <div class="small-box bg-secondary">
              <div class="inner">
                <div class="row">
                  <div class="col-6">
                    <h4 class="mb-1 mt-1"><span data-plugin="counterup">{{ small_count }}</span></h4>
                  </div>
                  <div class="col-6 text-right">
                    <h4 class="mb-1 mt-1"><span data-plugin="counterup">{{ small_percentage }}%</span></h4>
                  </div>
                </div>
                <div class="text-center">
                  <p class="text-white mb-0">SMALL</p>
                </div>
              </div>
              <div class="icon">
                <i class="ion ion-stats-ba"></i>
              </div>
              <a href="#" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a>
            </div>
          </div>
          <!-- ./col -->
          <div class="col-lg-3 col-6">
            <!-- small box -->
            <div class="small-box bg-warning">
              <div class="inner">
                <div class="row">
                  <div class="col-6">
                    <h4 class="mb-1 mt-1"><span data-plugin="counterup">{{ medium_count }}</span></h4>
                  </div>
                  <div class="col-6 text-right">
                    <h4 class="mb-1 mt-1"><span data-plugin="counterup">{{ medium_percentage }}%</span></h4>
                  </div>
                </div>
                <div class="text-center">
                  <p class="text-dark mb-0">MEDIUM</p>
                </div>
              </div>
              <div class="icon">
                <i class="ion ion-tools"></i>
              </div>
              <a href="#" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a>
            </div>
          </div>
          <!-- ./col -->
          <div class="col-lg-3 col-6">
            <!-- small box -->
            <div class="small-box bg-danger">
              <div class="inner">
                <div class="row">
                  <div class="col-6">
                    <h4 class="mb-1 mt-1"><span data-plugin="counterup">{{ large_count }}</span></h4>
                  </div>
                  <div class="col-6 text-right">
                    <h4 class="mb-1 mt-1"><span data-plugin="counterup">{{ large_percentage }}%</span></h4>
                  </div>
                </div>
                <div class="text-center">
                  <p class="text-white mb-0">LARGE</p>
                </div>
              </div>
              <div class="icon">
                <i class="ion ion-pie-gra"></i>
              </div>
              <a href="#" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a>
            </div>
          </div>
          <!-- ./col -->
        </div>
        <!-- /.row -->
        <div class="row">
          <div class="col-md-6 my-4">
              <div class="bg-white">
                  <div class="card-body">
                      <canvas id="sizeOfBusinessChart1" width="400" height="300"></canvas>
                      <script>
                          // Function to fetch data from Django view and render the bar chart
                          function fetchDataAndRenderBarChart() {
                              // Fetch data from the Django view
                              fetch("{% url 'size_of_business_data' %}")
                                  .then(response => response.json())
                                  .then(data => {
                                      // Extract labels and counts from the received data
                                      const labels = Object.keys(data);
                                      const counts = Object.values(data);
                                      const ctx = document.getElementById('sizeOfBusinessChart1').getContext('2d');
                                      const sizeOfBusinessChart1 = new Chart(ctx, {
                                          type: 'bar',
                                          data: {
                                              labels: labels,
                                              datasets: [{
                                                  // Label for the dataset
                                                  label: 'Number of SMEs by Size of Business',
                                                  // Data points
                                                  data: counts,
                                                  // Background color for the bars
                                                  backgroundColor: [
                                                      'rgba(0, 255, 0, 0.8)',     // Green for 'Micro'
                                                      'rgba(105, 105, 105, 0.5)', // Secondary (Gray) for 'Small'
                                                      'rgba(255, 193, 7, 1)',   // Yellow for 'Medium'
                                                      'rgba(255, 0, 0, 0.5)'      // Red for 'Large'
                                                  ],
                                                  // Border color for the bars
                                                  borderColor: [
                                                      'rgba(0, 255, 0, 1)',      // Green for 'Micro'
                                                      'rgba(105, 105, 105, 1)',  // Secondary (Gray) for 'Small'
                                                      'rgba(255, 193, 0, 1)',    // Yellow for 'Medium'
                                                      'rgba(255, 0, 0, 1)'       // Red for 'Large'
                                                  ],
                                                  borderWidth: 1
                                              }]
                                          },
                                          options: {
                                              scales: {
                                                  yAxes: [{
                                                      ticks: {
                                                          // Start y-axis from zero
                                                          beginAtZero: true,
                                                          // Set step size to 1 for whole numbers only
                                                          stepSize: 1,
                                                          // Format y-axis ticks with commas for better readability
                                                          callback: function(value) {
                                                              return Number(value).toLocaleString();
                                                          }
                                                      },
                                                      // Label for the y-axis
                                                      scaleLabel: {
                                                          display: true,
                                                          labelString: 'Number of SMEs'
                                                      }
                                                  }],
                                                  xAxes: [{
                                                      // Label for the x-axis
                                                      scaleLabel: {
                                                          display: true,
                                                          labelString: 'Size of Business'
                                                      }
                                                  }]
                                              }
                                          }
                                      });
                                  });
                          }
      
                          // Call the function to render the bar chart when the page is loaded
                          document.addEventListener("DOMContentLoaded", fetchDataAndRenderBarChart);
                      </script>
                  </div>
              </div>
          </div>
          <div class="col-md-6 my-4">
              <div class="bg-white">
                  <div class="card-body">
                      <canvas id="sizeOfBusinessChart2" width="400" height="300"></canvas>
                      <script>
                          // Function to fetch data from Django view and render the pie chart
                          function fetchDataAndRenderPieChart() {
                              // Fetch data from the Django view
                              fetch("{% url 'size_of_business_data' %}")
                                  .then(response => response.json())
                                  .then(data => {
                                      // Extract labels and counts from the received data
                                      const labels = Object.keys(data);
                                      const counts = Object.values(data);
                                      const ctx = document.getElementById('sizeOfBusinessChart2').getContext('2d');
                                      const sizeOfBusinessChart2 = new Chart(ctx, {
                                          type: 'pie',
                                          data: {
                                              labels: labels,
                                              datasets: [{
                                                  // Data points
                                                  data: counts,
                                                  // Background color for the slices
                                                  backgroundColor: [
                                                      'rgba(0, 255, 0, 0.8)',     // Green for 'Micro'
                                                      'rgba(105, 105, 105, 0.5)', // Secondary (Gray) for 'Small'
                                                      'rgba(255, 193, 7, 1)',   // Yellow for 'Medium'
                                                      'rgba(255, 0, 0, 0.5)'      // Red for 'Large'
                                                  ],
                                                  // Border color for the bars
                                                  borderColor: [
                                                      'rgba(0, 255, 0, 1)',      // Green for 'Micro'
                                                      'rgba(105, 105, 105, 1)',  // Secondary (Gray) for 'Small'
                                                      'rgba(255, 193, 0, 1)',    // Yellow for 'Medium'
                                                      'rgba(255, 0, 0, 1)'       // Red for 'Large'
                                                  ],
                                                  borderWidth: 1
                                              }]
                                          },
                                          options: {
                                              // Add options if needed
                                          }
                                      });
                                  });
                          }
      
                          // Call the function to render the pie chart when the page is loaded
                          document.addEventListener("DOMContentLoaded", fetchDataAndRenderPieChart);
                      </script>
                  </div>
              </div>
          </div>
      </div>
      
      


      </div><!-- /.container-fluid -->
    </section>
    <!-- /.content -->
  </div>
  {% endblock content %}

  {% block extra_scripts %}
  
    <!-- jQuery UI 1.11.4 -->
    <script src="{% static 'plugins/jquery-ui/jquery-ui.min.js' %}"></script>
    <!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
    <script>
      $.widget.bridge('uibutton', $.ui.button)
    </script>

    <!-- ChartJS -->
    <script src="{% static 'plugins/chart.js/Chart.min.js' %}"></script>
    <!-- Sparkline -->
    <script src="{% static 'plugins/sparklines/sparkline.js' %}"></script>
    <!-- JQVMap -->
    <script src="{% static 'plugins/jqvmap/jquery.vmap.min.js' %}"></script>
    <script src="{% static 'plugins/jqvmap/maps/jquery.vmap.usa.js' %}"></script>
    <!-- jQuery Knob Chart -->
    <script src="{% static 'plugins/jquery-knob/jquery.knob.min.js' %}"></script>
    <!-- daterangepicker -->
    <script src="{% static 'plugins/moment/moment.min.js' %}"></script>
    <script src="{% static 'plugins/daterangepicker/daterangepicker.js' %}"></script>
    <!-- Tempusdominus Bootstrap 4 -->
    <script src="{% static 'plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js' %}"></script>
    <!-- Summernote -->
    <script src="{% static 'plugins/summernote/summernote-bs4.min.js' %}"></script>
    <!-- overlayScrollbars -->
    <script src="{% static 'plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js' %}"></script>
    <!-- AdminLTE dashboard demo (This is only for demo purposes) -->
    <script src="{% static 'dist/js/pages/dashboard.js' %}"></script>
  
  {% endblock extra_scripts %}

